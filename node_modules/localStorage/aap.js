const formularioUI=document.getElementById('formulario'
	);
const listaUI=document.getElementById('listadeactividades');




var arregloActividades=[];

formularioUI.addEventListener('submit',(e)=>{

e.preventDefault();

var actividadUI=document.querySelector('#actividad').value;


llenarArreglo(actividadUI);
guardarDB();
mostrarLista();
formularioUI.reset();

});




const llenarArreglo=(actividad)=>{

var item={actividad: actividad, estado:false}

arregloActividades.push(item);

return item;



}

const guardarDB=()=>{
localStorage.setItem('rutina', JSON.stringify(arregloActividades));//enviando arreglo al locastorage


}



function mostrarLista()
{
  arregloActividades=JSON.parse(localStorage.getItem('rutina'));//trayendo arreglo del localStorage

 // console.log(arregloActividades);

  if (arregloActividades==null) //que el localstorage no venga vacio
   {
   	arregloActividades=[];

   }else{

		  listaUI.innerHTML='';

		  for(var arreglo of arregloActividades)
		  {
		  	if(arreglo.estado==true){
		  	listaUI.innerHTML+=`<div class="alert alert-success" role="alert">
		  	<i class="material-icons float-left mr-2">accessibility</i>
		    <b>${arreglo.actividad}</b>-${arreglo.estado}<span class="float-right">
		    <i class="material-icons">done</i><i class="material-icons">delete</i></span></div>`
		    }else{
		    	listaUI.innerHTML+=`<div class="alert alert-primary" role="alert">
		  	<i class="material-icons float-left mr-2">accessibility</i>
		    <b>${arreglo.actividad}</b>-${arreglo.estado}<span class="float-right">
		    <i class="material-icons">done</i><i class="material-icons">delete</i></span></div>`

		    }
		  }
	    }
}

document.addEventListener('DOMContentLoaded',mostrarLista);//es disparado cuando el documento HTML ha sido completamente cargado y parseado


listaUI.addEventListener('click',(e)=>{

e.preventDefault();

//console.log(e);

	
if(e.path){//si existe el evento path en chrome
		if(e.target.innerHTML=='delete' || e.target.innerHTML=='done' )//validando si doy clik en el done o delete
		{
			let texto=e.path[2].childNodes[3].innerHTML;//trae el nombre de la actividad
			
			if(e.target.innerHTML=='delete')
			{
            
             	eliminarBD(texto);
				
			}
			else if(e.target.innerHTML=='done')
			{
			   updateDB(texto);

			}
		}





}else if(e.originalTarget){//si existe el evento originalTarge en firefox

    if(e.target.innerHTML=='delete' || e.target.innerHTML=='done' ){
	   let tex=e.originalTarget.offsetParent.childNodes[3].innerHTML;

	   if(e.target.innerHTML=='delete'){
	   	eliminarBD(tex);
	   }else if(e.target.innerHTML=='done'){
	   	  updateDB(tex);
	   }
	}

}


});

let editarDB=(tarea)=>{
	let indice;

	arregloActividades.forEach((elemento, index)=>{
    
    if(elemento.actividad===tarea)
	    {
         indice=index;
	    }
  })
	arregloActividades[indice].estado=true;
	guardarDB();
}








let eliminarBD=(ejercicio)=>{
	
  let indexcantidad;

  arregloActividades.forEach((elemento, index)=>{

    if(elemento.actividad===ejercicio)
	    {
         indexcantidad=index;
	    }
  })
   arregloActividades.splice(indexcantidad,1);
   guardarDB();
   mostrarLista();

}


let updateDB=(texto)=>{

 let index;
 for(var arreglo in arregloActividades){    
    if(arregloActividades[arreglo].actividad==texto){
       index=arreglo;	
    }
 }

 arregloActividades[index].estado=true;

 guardarDB();
 mostrarLista();
 
}

