
let grupoDosUI=document.getElementById('grupoDos');
let grupoUnoUI=document.getElementById('grupoUno');
let tabla=document.getElementById('tablebody');


let personas=[];


//creando evento para consumir api
grupoUno.addEventListener('click',consumirApi);





function consumirApi()
{

	let url='https://randomuser.me/api/';
	var xhttp= new XMLHttpRequest();

	 xhttp.open('get',url, true);

	 xhttp.send();

	 xhttp.onreadystatechange=function(){
	 	if(this.readyState==4 && this.status==200){
	 	 var datos=JSON.parse(this.responseText); //convirtiendolo a json  



	 	 llenarPersona(datos);
	 	 guardarLocalStorage();
	 	 obtenerLocalStorage();
	 	}
	 }
}

function llenarPersona(datos){
          var nombre=datos.results[0].name.first;//nombre
	 	  var apellido=datos.results[0].name.last;//apellido
	 	  var email= datos.results[0].email;//email
	 	 var usuario=datos.results[0].login.username;//usuario
	 	 var estado=false;
	 	 personas.push({nombre:nombre,apellido:apellido,email:email,usuario:usuario,estado:estado});
        
	 	 
}

function guardarLocalStorage(){
	localStorage.setItem('trabajadores', JSON.stringify(personas));//arreglo enviado al localStorage
         
}




document.addEventListener('DOMContentLoaded',obtenerLocalStorage);//es disparado cuando el documento HTML ha sido completamente cargado y parseado



function obtenerLocalStorage(){


     //var numero;
	personas=JSON.parse(localStorage.getItem('trabajadores'));//trayendo arreglo del localStorage

	if(personas==null){
		personas=[];
	}else{
	 tabla.innerHTML='';
     

      var numero=0;
	 for(var arreglo of personas){
         numero++;
	 	if(arreglo.estado){
	 		tabla.innerHTML+=`
	 	 <tr class="table-success">
	      <th scope="row">${numero}</th>
	      <td>${arreglo.nombre}</td>
	      <td>${arreglo.apellido}</td>
	      <td>${arreglo.email}</td>
	      <td><b>${arreglo.usuario}</b>-${arreglo.estado ?"activo":"inactivo"} <span class="float-right">
	      <i class="material-icons">done</i><i class="material-icons">delete</i></span></td></tr>
	 	`
	 	}else{
	 		tabla.innerHTML+=`
	 	 <tr class="table-warning">
	      <th scope="row">${numero}</th>
	      <td>${arreglo.nombre}</td>
	      <td>${arreglo.apellido}</td>
	      <td>${arreglo.email}</td>
	      <td><b>${arreglo.usuario}</b>-${arreglo.estado ?"activo":"inactivo"} <span class="float-right">
	      <i class="material-icons">done</i><i class="material-icons">delete</i></span></td></tr>
	 	`
	 	}
	 	
	 }

	}
}

grupoDosUI.addEventListener('click', (e)=>{

	e.preventDefault();

	//console.log(e);
	//console.log(e.path[1].childNodes[9].childNodes[0].innerHTML);

	let texto=e.path[2].childNodes[0].innerHTML;

	if(e.target.innerHTML=='delete' || e.target.innerHTML=='done'){
	    if(e.target.innerHTML=="delete"){

         //console.log(texto);
         eliminarUsuario(texto);


	    }else if(e.target.innerHTML=="done"){
	    	update(texto);
	    }
	}
});



function eliminarUsuario(texto){

var index;
for(var p in personas){
	if(personas[p].usuario==texto){
      index=p;
	}
}
//console.log(index);

personas.splice(index,1);//funcion splice me permite eliminar un indice del arreglo con su respetivo valor
guardarLocalStorage();
obtenerLocalStorage();

}

function update(texto){
var inde;
for(var p in personas){
	if(personas[p].usuario==texto){
      inde=p;
	}
}
//console.log(inde);

personas[inde].estado=true;
guardarLocalStorage();
obtenerLocalStorage();

}

//buscar  con indexof

const formulario=document.getElementById('formulario');
const buscar=document.querySelector('#buscar');


const filtrar=()=>{//funcion para buscar
 //console.log(formulario.value);

personas=JSON.parse(localStorage.getItem('trabajadores'));//trayendo arreglo del localStorage


 const textoUI=formulario.value.toLowerCase();
 tabla.innerHTML='';
 let numero=0;
 for(let arreglo of personas){
 	numero++;
   let user=arreglo.usuario.toLowerCase();//buscando por usuario con indexof
   if(user.indexOf(textoUI)!==-1){
   	  if(arreglo.estado){
	 		tabla.innerHTML+=`
	 	 <tr class="table-success">
	      <th scope="row">${numero}</th>
	      <td>${arreglo.nombre}</td>
	      <td>${arreglo.apellido}</td>
	      <td>${arreglo.email}</td>
	      <td><b>${arreglo.usuario}</b>-${arreglo.estado ?"activo":"inactivo"} <span class="float-right">
	      <i class="material-icons">done</i><i class="material-icons">delete</i></span></td></tr>
	 	`
	 	}else{
	 		tabla.innerHTML+=`
	 	 <tr class="table-warning">
	      <th scope="row">${numero}</th>
	      <td>${arreglo.nombre}</td>
	      <td>${arreglo.apellido}</td>
	      <td>${arreglo.email}</td>
	      <td><b>${arreglo.usuario}</b>-${arreglo.estado ?"activo":"inactivo"} <span class="float-right">
	      <i class="material-icons">done</i><i class="material-icons">delete</i></span></td></tr>
	 	`
	 	}
   }
 }

 if(tabla.innerHTML===''){
   tabla.innerHTML+='<th>usuario no encontrado</th>'
 }

 
}


formulario.addEventListener('keyup',filtrar);//evento precionar tecla

//recordando


function caminar(){
    var perro="matias";

    function responsable(){
        var nombre="fernandez";
        var show= nombre + " es el dueno de "+perro;
        return actividades;

                function actividades(){
                  var ats=show + ", ya que matias es un perro";
                  return ats;
                }
    }

    return responsable;
}

var total=caminar();

Lnombre.innerHTML+=total()();




var objeto = {
    unArray: new Array(10000)
    };

    console.time('test');
    for(var i=0; i<objeto.unArray.length; i++) {
    objeto.unArray[i] = "Hola!";
    }
    console.timeEnd('test');

  console.time('test');
  var arreglo=objeto.unArray;
  var longitud=arreglo.length;
  for(var i=0; i<longitud;i++){
    arreglo[i]='hola';
  }
  console.timeEnd('test');


  var libro = {
    titulo: "Aprendiendo JavaScript",
    autor: "Carlos Azaustre",
    numPaginas: 64,
    editorial: "carlosazaustre.es",
    precio: "2.95"
    };
    for(var prop in libro) {
    console.log("La propiedad " +prop+ " contiene: " +libro[prop] );
    }
    console.log(libro);

